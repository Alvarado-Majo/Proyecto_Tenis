<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Tienda de tenis</title>
    <link rel="stylesheet" th:href="@{/css/estilos.css}">
</head>
<body>

<!-- HEADER -->
<header style="width:90%; margin:auto; padding-top:15px; display:flex; justify-content:space-between; align-items:center;">
    <div style="font-weight:bold; color:var(--turquesa); font-size:20px;">
        Tienda de Tenis
    </div>
    <nav style="display:flex; gap:15px; align-items:center;">
    <a th:href="@{/}" style="text-decoration:none; color:var(--gris);">Inicio</a>
    <a th:href="@{/carrito}" style="text-decoration:none; color:var(--gris);">Ver carrito</a>

    <!-- SI NO hay cliente logueado -->
    <div th:if="${session.clienteLogueado == null}" style="display:flex; gap:15px;">
        <a th:href="@{/login}"
           style="text-decoration:none; color:var(--rosado); font-weight:bold;">
            Iniciar sesión
        </a>
        <a th:href="@{/registro}"
           style="text-decoration:none; color:var(--turquesa); font-weight:bold;">
            Registrarse
        </a>
    </div>

    <!-- SI hay cliente logueado -->
    <div th:if="${session.clienteLogueado != null}"
         style="display:flex; gap:10px; align-items:center;">

        <span style="color:var(--gris);">
            Hola,
            <strong th:text="${session.clienteLogueado.nombre}">Cliente</strong>
        </span>

        <a th:href="@{/logout-cliente}"
           style="text-decoration:none; color:red; font-weight:bold;">
            Cerrar sesión
        </a>
    </div>
</nav>

</header>

<div class="contenedor">

    <h1 class="titulo">Catálogo de Tenis</h1>

    <!-- Mensajes -->
    <div th:if="${ok}" class="alert alert-ok" th:text="${ok}"></div>
    <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>

    <!-- FILTROS -->
    <div class="filtros">
        <form th:action="@{/}" method="get">
            <input type="text"
                   name="buscar"
                   th:value="${buscar}"
                   placeholder="Buscar por nombre...">

            <select name="categoria">
                <option value="">Todas las categorías</option>
                <option th:each="c : ${categorias}"
                        th:value="${c.idCategoria}"
                        th:selected="${idCategoria != null && idCategoria == c.idCategoria}"
                        th:text="${c.nombre}">
                </option>
            </select>

            <button type="submit">Filtrar</button>
        </form>
    </div>

    <!-- CATÁLOGO -->
    <div class="catalogo">

        <!-- Si no hay tenis -->
        <p th:if="${#lists.isEmpty(tenisList)}">No hay productos disponibles.</p>

        <!-- Lista de tenis -->
        <div class="card" th:each="t : ${tenisList}">

            <a th:href="@{/detalle/{id}(id=${t.idTenis})}">
                <img th:src="${t.imagen}" alt="Imagen del tenis">
            </a>

            <h3 th:text="${t.nombre}">Nombre tenis</h3>

            <p><strong>₡</strong> <span th:text="${t.precio}">0.0</span></p>

            <p th:text="'Marca: ' + ${t.marca}">Marca</p>

            <!-- STOCK -->
            <p th:if="${t.stock != null && t.stock > 0}">
                Stock disponible: <span th:text="${t.stock}"></span>
            </p>

            <p th:if="${t.stock == null || t.stock <= 0}" class="sin-stock">
                Sin stock
            </p>

            <!-- BOTÓN COMPRAR (solo si hay stock válido) -->
            <form th:if="${t.stock != null && t.stock > 0}"
                  th:action="@{/agregar-carrito/{id}(id=${t.idTenis})}"
                  method="post">
                <input type="hidden" name="cantidad" value="1">
                <button type="submit" class="btn-comprar">Agregar al carrito</button>
            </form>

        </div>

    </div>

</div>

</body>
</html>
